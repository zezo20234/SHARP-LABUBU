<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dashboard & Report</title>
<style>
body {
font-family: Arial, sans-serif;
background: #f0f4f8;
color: #333;
margin: 0;
padding: 20px;
display: flex;
flex-direction: column;
align-items: center;
min-height: 100vh;
}
h1, h2 {
color: #0057e7;
text-shadow: 0 1px 2px rgba(0, 87, 231, 0.3);
margin-bottom: 20px;
}
/* Container for days and credits */
#status {
position: fixed;
top: 20px;
left: 20px;
background: white;
padding: 15px 20px;
border-radius: 8px;
box-shadow: 0 2px 10px rgba(0,0,0,0.1);
font-weight: bold;
min-width: 160px;
user-select: none;
}
/* Main containers */
#login-container, #report-form, #credits-form {
background: white;
padding: 30px 40px;
border-radius: 10px;
box-shadow: 0 4px 15px rgba(0, 87, 231, 0.2);
width: 350px;
margin-bottom: 40px;
animation: fadeIn 0.8s ease forwards;
display: flex;
flex-direction: column;
gap: 10px;
}
#report-form {
width: 400px;
gap: 20px;
}
#credits-form {
gap: 20px;
margin-bottom: 20px;
}
/* Form elements */
label {
font-weight: 600;
}
input[type="text"],
input[type="password"],
input[type="number"],
select,
textarea {
width: 100%;
padding: 10px 12px;
border-radius: 6px;
border: 1.5px solid #ddd;
font-size: 1rem;
transition: border-color 0.3s ease;
resize: vertical;
}
input:focus, select:focus, textarea:focus {
border-color: #0057e7;
outline: none;
}
/* Buttons */
button {
width: 100%;
background-color: #0057e7;
border: none;
color: white;
padding: 12px;
font-size: 1.1rem;
font-weight: bold;
border-radius: 8px;
cursor: pointer;
box-shadow: 0 3px 8px rgba(0,87,231,0.5);
transition: background-color 0.3s ease;
}
button:hover {
background-color: #0040c0;
}
#logout-btn {
margin-top: 10px;
padding: 8px 16px;
background-color: #f44336;
border: none;
color: white;
font-weight: bold;
border-radius: 8px;
cursor: pointer;
box-shadow: 0 3px 8px rgba(244,67,54,0.5);
transition: background-color 0.3s ease;
align-self: center;
display: none;
}
#logout-btn:hover {
background-color: #d32f2f;
}
#login-error {
color: #f44336;
margin-top: 10px;
display: none;
}
/* Other containers */
#keep-signed-in-container {
display: flex;
align-items: center;
gap: 8px;
font-weight: 600;
user-select: none;
}
#rules-container {
max-height: 200px;
overflow-y: auto;
border: 1.5px solid #ddd;
border-radius: 6px;
padding: 10px;
background: #fafafa;
}
.rule-box {
padding: 6px 8px;
border-bottom: 1px solid #ddd;
display: flex;
align-items: center;
gap: 10px;
cursor: pointer;
transition: background-color 0.2s ease;
}
.rule-box:last-child {
border-bottom: none;
}
.rule-box:hover {
background-color: #e1e8ff;
}
.rule-box input[type="checkbox"] {
cursor: pointer;
width: 18px;
height: 18px;
}
.rule-label {
user-select: none;
font-weight: 600;
}
.rule-details {
font-size: 0.9rem;
color: #555;
margin-left: 28px;
margin-top: 2px;
margin-bottom: 6px;
border-top: 1px solid #eee;
padding-top: 4px;
font-style: italic;
}
/* Animations */
@keyframes fadeIn {
from {opacity: 0; transform: translateY(10px);}
to {opacity: 1; transform: translateY(0);}
}
/* Responsive */
@media (max-width: 460px) {
#login-container, #report-form, #credits-form {
width: 90vw;
padding: 25px 20px;
}
#status {
position: static;
margin-bottom: 20px;
}
}
</style>
</head>
<body>
<div id="status" style="display:none;">
Days: <span id="days-count">0</span><br />
Credits: <span id="credits-count">0</span>
</div>
<div id="login-container">
<h1>Login</h1>
<label for="username">Username</label>
<input type="text" id="username" placeholder="Enter your username" autocomplete="off" />
<label for="password">Password</label>
<input type="password" id="password" placeholder="Enter your password" autocomplete="off" />
<div id="keep-signed-in-container">
<input type="checkbox" id="keep-signed-in" />
<label for="keep-signed-in">Keep me signed in</label>
</div>
<button id="login-btn">Login</button>
<p id="login-error"></p>
</div>
<div style="display: none; flex-direction: column; align-items: center;" id="main-app">
<form id="report-form">
<h2>Make a Report</h2>
<label for="reported-user">Who is this report on?</label>
<select id="reported-user" required>
<option value="" disabled selected>Select user</option>
<option value="zezo">Zezo</option>
<option value="layan">Layan</option>
<option value="asser">Asser</option>
<option value="bank">Bank</option>
</select>
<label for="report-details">What did the user do? (optional)</label>
<textarea id="report-details" placeholder="Describe the behavior..."></textarea>
<label>Rules Broken (select one or more)</label>
<div id="rules-container">
</div>
<button type="submit" id="submit-report">Submit Report</button>
</form>
<hr style="width: 100%; border: none; border-top: 1px solid #ccc; margin: 30px 0;">
<div id="credits-form">
<h2>Send Credits</h2>
<label for="credits-recipient">Recipient</label>
<select id="credits-recipient">
<option value="" disabled selected>Select user</option>
<option value="zezo">Zezo</option>
<option value="layan">Layan</option>
<option value="asser">Asser</option>
<option value="bank">Bank</option>
</select>
<label for="credits-amount">Amount</label>
<input type="number" id="credits-amount" placeholder="Enter amount" min="1" required>
<button id="send-credits-btn">Send Credits</button>
</div>
</div>
<button id="logout-btn">Logout</button>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, set, runTransaction, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
const firebaseConfig = {
apiKey: "AIzaSyAjeXycCBhYoAU-0iiC4LbSTylKrrThN8Y",
authDomain: "sharplabubu.firebaseapp.com",
databaseURL: "https://sharplabubu-default-rtdb.firebaseio.com",
projectId: "sharplabubu",
storageBucket: "sharplabubu.firebasestorage.app",
messagingSenderId: "596148393481",
appId: "1:596148393481:web:4f822d86c44a13bd810ad8",
measurementId: "G-4M25R3BF08"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const rules = [
{ name: "No hit", days: 1, detail: "Do not physically hurt anyone, as a joke is ok +1 days." },
{ name: "No scream", days: 5, detail: "Speak calmly, only when you are excited or angry +5 days." },
{ name: "No cry", days: 1, detail: "Crying is not allowed +1 days." },
{ name: "Zeyad can no longer make you play with devices when you have days", days: 20, detail: "If Zeyad makes you play with devices when you have days, +20 days to Zeyad!" },
{ name: "No fetn", days: 100, detail: "Don't make FETN. If someone tells you “blip” please don’t tell or repeat it to anyone. +100 days." },
{ name: "No bother", days: 5, detail: "Respect others. Don’t annoy them. +5 days." },
{ name: "You have to respect", days: 10, detail: "Treat everyone kindly and with respect, always. +10 days." },
{ name: "CUTE +50 DAYS", days: 50, detail: "Be cute for 5 minutes = +50 days." }
];
// Initialize UI Elements
const loginContainer = document.getElementById('login-container');
const mainAppContainer = document.getElementById('main-app');
const reportForm = document.getElementById('report-form');
const creditsForm = document.getElementById('credits-form');
const loginBtn = document.getElementById('login-btn');
const loginError = document.getElementById('login-error');
const usernameInput = document.getElementById('username');
const passwordInput = document.getElementById('password');
const statusDiv = document.getElementById('status');
const daysCountSpan = document.getElementById('days-count');
const creditsCountSpan = document.getElementById('credits-count');
const rulesContainer = document.getElementById('rules-container');
const keepSignedInCheckbox = document.getElementById('keep-signed-in');
const logoutBtn = document.getElementById('logout-btn');
const creditsRecipientSelect = document.getElementById('credits-recipient');
const creditsAmountInput = document.getElementById('credits-amount');
const sendCreditsBtn = document.getElementById('send-credits-btn');
// Populate rules in UI
function populateRules() {
rules.forEach((rule, index) => {
const div = document.createElement('div');
div.className = 'rule-box';
div.innerHTML = `
<input type="checkbox" id="rule-${index}" name="rules" value="${rule.days}">
<label class="rule-label" for="rule-${index}">${rule.name}</label>
<div class="rule-details">${rule.detail}</div>
`;
rulesContainer.appendChild(div);
});
}
populateRules();
// User session info
let currentUser = null;
// Check for existing session on load
window.addEventListener('DOMContentLoaded', () => {
const savedUser = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
if (savedUser) {
currentUser = savedUser;
loginContainer.style.display = 'none';
mainAppContainer.style.display = 'flex';
statusDiv.style.display = 'block';
logoutBtn.style.display = 'block';
loadUserData();
}
});
// Login button click handler
loginBtn.addEventListener('click', async () => {
const username = usernameInput.value.trim().toLowerCase();
const password = passwordInput.value.trim();
loginError.style.display = 'none';
if (!username || !password) {
loginError.textContent = 'Please enter both username and password.';
loginError.style.display = 'block';
return;
}
try {
const userRef = ref(db, 'users/' + username);
const snapshot = await get(userRef);
if (!snapshot.exists()) {
loginError.textContent = 'User not found.';
loginError.style.display = 'block';
return;
}
const userData = snapshot.val();
if (userData.password !== password) {
loginError.textContent = 'Incorrect password.';
loginError.style.display = 'block';
return;
}
currentUser = username;
if (keepSignedInCheckbox.checked) {
localStorage.setItem('currentUser', currentUser);
} else {
sessionStorage.setItem('currentUser', currentUser);
}
loginContainer.style.display = 'none';
mainAppContainer.style.display = 'flex';
statusDiv.style.display = 'block';
logoutBtn.style.display = 'block';
loadUserData();
} catch (error) {
loginError.textContent = 'Error during login. Try again.';
loginError.style.display = 'block';
console.error('Login error:', error);
}
});
// Logout button handler
logoutBtn.addEventListener('click', () => {
currentUser = null;
localStorage.removeItem('currentUser');
sessionStorage.removeItem('currentUser');
loginContainer.style.display = 'flex';
mainAppContainer.style.display = 'none';
statusDiv.style.display = 'none';
logoutBtn.style.display = 'none';
usernameInput.value = '';
passwordInput.value = '';
keepSignedInCheckbox.checked = false;
daysCountSpan.textContent = '0';
creditsCountSpan.textContent = '0';
});
// Load and display user data (days & credits) from Firebase
async function loadUserData() {
if (!currentUser) return;
try {
const userRef = ref(db, 'users/' + currentUser);
const snapshot = await get(userRef);
if (!snapshot.exists()) {
alert('User data not found.');
return;
}
const userData = snapshot.val();
// --- NEW: Daily day deduction logic ---
let days = userData.days ?? 0;
let lastDeductionTimestamp = userData.lastDeductionTimestamp ?? Date.now();
const oneDayInMs = 24 * 60 * 60 * 1000;
const now = Date.now();
if (now - lastDeductionTimestamp >= oneDayInMs) {
const daysToDeduct = Math.floor((now - lastDeductionTimestamp) / oneDayInMs);
days = Math.max(0, days - daysToDeduct); // Ensure days don't go below 0
lastDeductionTimestamp = now;
// Update the database with the new days count and timestamp
await set(userRef, { ...userData, days, lastDeductionTimestamp });
}
// --- END NEW ---
const credits = userData.credits ?? 0;
daysCountSpan.textContent = days;
creditsCountSpan.textContent = credits;
} catch (error) {
console.error('Error loading user data:', error);
}
}
// Report submission handler
reportForm.addEventListener('submit', async (e) => {
e.preventDefault();
if (!currentUser) {
alert('You must be logged in to submit a report.');
return;
}
const reportedUser = document.getElementById('reported-user').value;
const reportDetails = document.getElementById('report-details').value.trim();
const selectedRulesCheckboxes = Array.from(document.querySelectorAll('#rules-container input[type="checkbox"]:checked'));
if (selectedRulesCheckboxes.length === 0) {
alert('Please select at least one rule broken.');
return;
}
const totalDays = selectedRulesCheckboxes.reduce((acc, cb) => acc + Number(cb.value), 0);
const newReport = {
reportedUser,
reportDetails,
rulesBroken: selectedRulesCheckboxes.map(cb => cb.nextElementSibling.textContent),
daysToAdd: totalDays,
reporter: currentUser,
timestamp: Date.now(),
status: 'pending'
};
try {
const reportsRef = ref(db, 'reports/' + reportedUser);
const newReportRef = push(reportsRef);
await set(newReportRef, newReport);
alert('Report submitted and pending approval.');
reportForm.reset();
} catch (error) {
alert('Error submitting report.');
console.error('Report error:', error);
}
});
// --- NEW: Credits sender logic ---
sendCreditsBtn.addEventListener('click', async () => {
const recipient = creditsRecipientSelect.value;
const amount = parseInt(creditsAmountInput.value, 10);
if (!recipient || amount <= 0 || isNaN(amount)) {
alert('Please select a recipient and enter a valid amount.');
return;
}
if (recipient === currentUser) {
alert('You cannot send credits to yourself.');
return;
}
const senderRef = ref(db, 'users/' + currentUser);
const recipientRef = ref(db, 'users/' + recipient);
try {
await runTransaction(senderRef, (currentData) => {
if (currentData) {
currentData.credits = (currentData.credits ?? 0) - amount;
if (currentData.credits < 0) {
return; 
}
return currentData;
}
return null;
});
await runTransaction(recipientRef, (currentData) => {
if (currentData) {
currentData.credits = (currentData.credits ?? 0) + amount;
return currentData;
}
return { credits: amount, days: 0 }; 
});
alert(`Successfully sent ${amount} credits to ${recipient}.`);
loadUserData(); 
creditsAmountInput.value = '';
creditsRecipientSelect.value = '';
} catch (error) {
console.error('Credits transaction failed:', error);
alert('Transaction failed. You may not have enough credits or an error occurred.');
}
});
</script>
</body>
</html>
