<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Login, Report, Shop & Credits Sender with Signature</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2b4c7e" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<style>
/* ---------- existing styles (kept) ---------- */
body {
  font-family: Arial, sans-serif;
  max-width: 700px;
  margin: 30px auto;
  padding: 10px;
  background: linear-gradient(135deg, #f0f4f9, #d9e4f5);
  color: #333;
  font-size: 1rem;
  line-height: 1.4;
}

@media (max-width: 700px) {
  body {
    max-width: 100%;
    margin: 10px;
    padding: 10px 15px;
  }
}

h2, h3 {
  color: #2b4c7e;
  margin-bottom: 10px;
}

button, input, select {
  width: 100%;
  max-width: 100%;
  padding: 12px;
  margin-top: 6px;
  font-size: 1.1rem;
  box-sizing: border-box;
  border-radius: 6px;
  border: 1px solid #ccc;
  touch-action: manipulation;
}

button {
  background: #2b4c7e;
  color: white;
  cursor: pointer;
  user-select: none;
}

button:hover {
  background: #1f3557;
}

#user-info {
  position: fixed;
  top: 10px;
  left: 10px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(15px);
  border-radius: 20px;
  padding: 10px 20px;
  font-weight: bold;
  border: 1px solid rgba(255, 255, 255, 0.2);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  display: none;
  color: red; /* ALL TEXT COLOR SET TO BLUE */
  z-index: 9999; /* HIGHEST Z-INDEX */
}

@media (max-width: 500px) {
  #user-info {
    font-size: 0.9rem;
    padding: 8px 10px;
    top: auto;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    max-width: 95vw;
    text-align: center;
  }
}

#logoutBtn {
  background: #e74c3c;
  margin-top: 8px;
  font-size: 0.9rem;
  padding: 8px;
}

#logoutBtn:hover {
  background: #c0392b;
}

#login-form, #report-form {
  background: white;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

label {
  font-weight: bold;
  margin-top: 15px;
  display: block;
}

.rules-list {
  margin-top: 10px;
  max-height: 250px;
  overflow-y: auto;
  border: 1px solid #ccc;
  padding: 10px;
  border-radius: 6px;
  background: #fafafa;
}

.rule-item {
  padding: 8px;
  border-radius: 5px;
  cursor: pointer;
  transition: background 0.3s ease;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.rule-item:hover {
  background: #e6f0ff;
}
.rule-item.selected {
  background: #ff0000; /* Changed from red to blue for better contrast */
  color: white;
  animation: bounceForward 0.45s ease;
}

.rule-details {
  font-size: 0.9rem;
  color: inherit;
  margin-top: 4px;
  flex-basis: 100%;
}

.rule-qty {
  width: 50px;
  margin-left: 10px;
  font-size: 1rem;
}

.action-buttons {
  margin-top: 20px;
  text-align: center;
}
.action-buttons button {
  width: auto;
  padding: 10px 15px;
  margin: 5px;
  border-radius: 25px;
  font-weight: bold;
  font-size: 1rem;
  user-select: none;
}
.action-buttons button:nth-child(1) {
  background: #27ae60;
}
.action-buttons button:nth-child(1):hover {
  background: #1e8449;
}
.action-buttons button:nth-child(2) {
  background: #2980b9;
}
.action-buttons button:nth-child(2):hover {
  background: #1f6391;
}

.action-buttons button:nth-child(3) {
  background: #8e44ad; /* Points exchange button color */
}
.action-buttons button:nth-child(3):hover {
  background: #6a2a89;
}


#shopContainer, #creditsSenderContainer, #pointsExchangeContainer {
  border: 1px solid #ccc;
  padding: 15px;
  margin-top: 15px;
  border-radius: 8px;
  background: white;
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transform: scaleY(0.9);
  transition: all 0.4s ease;
}
#shopContainer.show, #creditsSenderContainer.show, #pointsExchangeContainer.show {
  max-height: 800px;
  overflow-y: auto;
  opacity: 1;
  transform: scaleY(1);
}

#welcomeOverlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(80, 80, 80, 0.7);
  color: white;
  font-size: 2rem;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: pointer;
  text-align: center;
  padding: 20px;
}
#welcomeOverlay small {
  font-size: 1.2rem;
  margin-top: 15px;
  opacity: 0.8;
}

/* === ANIMATIONS === */

/* Button bounce backward (away) */
@keyframes bounceBack {
  0% { transform: scale(1); }
  30% { transform: scale(0.92); }
  60% { transform: scale(1.02); }
  100% { transform: scale(1); }
}
button:active {
  animation: bounceBack 0.25s ease;
}

/* Rule bounce forward (towards) */
@keyframes bounceForward {
  0% { transform: scale(1); }
  30% { transform: scale(1.08); }
  60% { transform: scale(0.98); }
  100% { transform: scale(1); }
}
.rule-item.bounce {
  animation: bounceForward 0.25s ease;
}

/* === EVENTS SECTION STYLING === */
#eventsSection {
  margin-top: 20px;
  padding: 20px;
  background: white;
  border-radius: 10px;
  box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}
.event-item {
  border: 1px solid #ccc;
  padding: 10px;
  margin: 10px 0;
  border-radius: 5px;
  background: #f9f9f9;
}

/* ---------- Dynamic Island styles (ADDED) ---------- */
#dynamicIslandWrap {
  position: fixed;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  z-index: 10001;
  width: min(680px, calc(100% - 40px));
  max-width: 700px;
  pointer-events: none; /* allow clicks to pass except on inner */
}

#dynamicIsland {
  pointer-events: auto;
  margin: 0 auto;
  width: 100%;
  max-width: 700px;
  border-radius: 28px;
  padding: 10px 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.18);
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: white;
  background: linear-gradient(90deg,#333,#444);
  transition: transform 0.28s cubic-bezier(.2,.9,.3,1), height 0.28s ease, opacity 0.2s ease, background 0.2s ease;
  cursor: grab;
  user-select: none;
  overflow: hidden;
}

#dynamicIsland.closed {
  height: 48px;
}

#dynamicIsland.expanded {
  height: auto;
  padding: 14px;
  border-radius: 14px;
  flex-direction: column;
  align-items: stretch;
}

#islandMainRow {
  display:flex;
  align-items:center;
  gap:12px;
  width:100%;
  justify-content:space-between;
}

#islandLeft {
  display:flex;
  align-items:center;
  gap:10px;
  min-width: 0;
}

#islandIcon {
  width:36px;
  height:36px;
  border-radius:8px;
  background: rgba(255,255,255,0.12);
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  font-size: 0.95rem;
}

#islandText {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight:600;
  font-size: 0.95rem;
  min-width: 0;
}

#islandChevron {
  margin-left: 10px;
  opacity: 0.9;
  transform: rotate(0deg);
  transition: transform 0.2s ease;
}

#dynamicIsland.expanded #islandChevron {
  transform: rotate(180deg);
}

/* expanded content area */
#islandExpanded {
  margin-top: 10px;
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
}

.islandBtn {
  width: 100%;
  padding: 10px;
  border-radius: 12px;
  font-weight:700;
  text-align:center;
  border: none;
  cursor: pointer;
}

#islandControls {
  display:flex;
  gap:8px;
  margin-top:8px;
  align-items:center;
  justify-content:space-between;
  grid-column: 1 / -1;
}

.colorDot {
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: 2px solid rgba(255,255,255,0.3);
  cursor:pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* small icon/button in right when closed */
#islandSmallRight {
  display:flex;
  align-items:center;
  gap:8px;
  min-width: 0;
}

/* responsive tweaks */
@media (max-width: 600px) {
  #dynamicIsland {
    left: 50%;
    transform: translateX(-50%);
    width: calc(100% - 20px);
  }
  #islandExpanded {
    grid-template-columns: 1fr;
  }
}

/* make sure dynamic island doesn't collide with user-info - add small offset if needed */
body.with-island #user-info {
  top: 70px;
}

/* tiny visual for label under closed island */
#islandTickerSmall {
  font-size: 0.85rem;
  opacity: 0.95;
}

/* ===== Small-screen (iPhone) adjustments ===== */
@media (max-width: 420px) {
  #dynamicIslandWrap { top: 8px; width: calc(100% - 24px); }
  #dynamicIsland.closed { height: 40px; padding: 8px 12px; border-radius: 20px; }
  #islandIcon { width:30px; height:30px; border-radius:6px; font-size:0.85rem; }
  #islandText { font-size:0.85rem; }
  #islandTickerSmall { font-size:0.78rem; }
  .colorDot { width:24px; height:24px; }
  .islandBtn { padding: 8px; font-size:0.95rem; border-radius:10px; }
}

/* ===== Bounce animations for open/close ===== */
@keyframes bounce-down {
  0% { transform: translateY(-6px); }
  40% { transform: translateY(18px); }
  60% { transform: translateY(-6px); }
  100% { transform: translateY(0); }
}
@keyframes bounce-up {
  0% { transform: translateY(6px); }
  40% { transform: translateY(-18px); }
  60% { transform: translateY(6px); }
  100% { transform: translateY(0); }
}

.dynamic-bounce-down {
  animation: bounce-down 420ms cubic-bezier(.2,.9,.3,1);
}
.dynamic-bounce-up {
  animation: bounce-up 420ms cubic-bezier(.2,.9,.3,1);
}

/* ensure transform changes from bounce don't conflict with transitions when not dragging */
</style>
</head>
<body>

<div id="welcomeOverlay">
  <div id="welcomeText"></div>
  <small>Click to continue</small>
</div>
<audio id="welcomeAudio" src="header-39344.mp3"></audio>

<!-- NEW: Dynamic Island wrapper -->
<div id="dynamicIslandWrap">
  <div id="dynamicIsland" class="closed" role="button" tabindex="-1">
    <div id="islandMainRow">
      <div id="islandLeft">
        <div id="islandIcon">DI</div>
        <div id="islandText">
          <span id="islandTickerSmall">Loading...</span>
        </div>
      </div>
      <div id="islandSmallRight">
        <div id="islandBadge" style="font-weight:700; font-size:0.95rem;">&nbsp;</div>
        <div id="islandChevron">▾</div>
      </div>
    </div>

    <!-- expanded content -->
    <div id="islandExpanded" style="display:none; width:100%;">
      <button class="islandBtn" id="islandOpenShop">Open Shop</button>
      <button class="islandBtn" id="islandSendLazuzu">Send LAZUZU</button>
      <button class="islandBtn" id="islandPointsExchange">Points Exchange</button>

      <div id="islandControls" style="grid-column: 1 / -1;">
        <div style="display:flex;gap:8px;align-items:center;">
          <div style="font-weight:700;">Customize</div>
          <div class="colorDot" data-color="linear-gradient(90deg,#ff7a00,#ff9e4a)" title="Orange" style="background: linear-gradient(90deg,#ff7a00,#ff9e4a)"></div>
          <div class="colorDot" data-color="linear-gradient(90deg,#ffed4a,#ffd84a)" title="Yellow" style="background: linear-gradient(90deg,#ffed4a,#ffd84a)"></div>
          <div class="colorDot" data-color="linear-gradient(90deg,#ff7ac2,#ff9ed6)" title="Pink" style="background: linear-gradient(90deg,#ff7ac2,#ff9ed6)"></div>
          <div class="colorDot" data-color="linear-gradient(90deg,#8e44ad,#b07be0)" title="Purple" style="background: linear-gradient(90deg,#8e44ad,#b07be0)"></div>
          <div class="colorDot" data-color="linear-gradient(90deg,#ff4b4b,#ff6b6b)" title="Red" style="background: linear-gradient(90deg,#ff4b4b,#ff6b6b)"></div>
          <div class="colorDot" data-color="linear-gradient(90deg,#000000,#333333)" title="Black" style="background: linear-gradient(90deg,#000000,#333333)"></div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;">
          <button id="islandCollapse" class="islandBtn" style="background:rgba(255,255,255,0.12)">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="user-info">
Days: <span id="days-count">0</span> | LAZUZU <img src="LAZUZU.jpg" style="width:1em;height:1em;vertical-align:middle;">: <span id="credits-count">0</span> | Points: <span id="points-count">0</span> | Signature Days Left: <span id="sig-days-left">0</span>
<button id="logoutBtn" style="display:none;">Logout</button>
</div>

<div id="login-form">
<h2>Login</h2>
<input type="text" id="username" placeholder="Username" />
<input type="password" id="password" placeholder="Password" />
<label><input type="checkbox" id="keepSignedIn"> Keep me signed in</label>
<button id="loginBtn">Login</button>
</div>

<div id="report-form" style="display:none;">
<h2>Report Form</h2>
<form id="reportForm">
<label>Your Username</label>
<input type="text" id="reporter" readonly />
<label>Who is this report on?</label>
<select id="reportedUser" required ></select>
<label>Rules broken:</label>
<div class="rules-list" id="rulesList"></div>
<div id="total-days">Total Days Penalty: 0</div>
<button type="submit" style="margin-top:20px;">Submit Report</button>
</form>
</div>

<!-- action-buttons container kept but WITHOUT the three toggles as requested -->
<div class="action-buttons" id="action-buttons" style="display:none;">
<hr>
</div>

<div id="shopContainer">
<h3>- Days Shop (Spend LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> to reduce days)</h3>
<div id="shopItems"></div>
</div>

<div id="pointsExchangeContainer">
<h3>Points Exchange (Trade Points for LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;">)</h3>

<div id="pointsExchangeItems"></div>
</div>

<div id="creditsSenderContainer">
<h3>Send LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"></h3>
<label>Send to:</label>
<select id="sendToUser"></select>
<label>Amount:</label>
<input type="number" id="sendAmount" min="1" />
<button onclick="sendCredits()">Send</button>
</div>

<hr>
<div id="eventsSection">
<h2>Events</h2>
<div id="eventsList">Loading events...</div>
</div>

<audio id="saveSignatureAudio" src="welcome.mp3" preload="auto"></audio>
<audio id="applePayAudio" src="applepay.mp3" preload="auto"></audio>

<script type="module">
import { initializeApp, getApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, update, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

// === FIREBASE CONFIG ===
// WARNING: Exposing API keys like this is a security risk.
// For production, consider using Firebase Hosting or a backend server.
const firebaseConfig = {
  apiKey: "AIzaSyAjeXycCBhYoAU-0iiC4LbSTylKrrThN8Y",
  authDomain: "sharplabubu.firebaseapp.com",
  databaseURL: "https://sharplabubu-default-rtdb.firebaseio.com",
  projectId: "sharplabubu",
  storageBucket: "sharplabubu.firebasestorage.app",
  messagingSenderId: "596148393481",
  appId: "1:596148393481:web:4f822d86c44a13bd810ad8",
  measurementId: "G-4M25R3BF08"
};

let app;
try {
  app = getApp();
} catch (e) {
  app = initializeApp(firebaseConfig);
}
const db = getDatabase(app);

// === GLOBAL VARIABLES & DOM REFERENCES ===
let currentUser = null, currentUserData = null;
const daysSpan = document.getElementById("days-count");
const creditsSpan = document.getElementById("credits-count");
const pointsSpan = document.getElementById("points-count");
const sigDaysLeftSpan = document.getElementById("sig-days-left");
const reportedUserSelect = document.getElementById("reportedUser");
const sendToUserSelect = document.getElementById("sendToUser");
const reporterInput = document.getElementById("reporter");
const logoutBtn = document.getElementById("logoutBtn");
const welcomeOverlay = document.getElementById("welcomeOverlay");
const welcomeText = document.getElementById("welcomeText");
const welcomeAudio = document.getElementById("welcomeAudio");
const eventsListEl = document.getElementById("eventsList");

// --- dynamic island nodes ---
const dynamicIsland = document.getElementById("dynamicIsland");
const islandTicker = document.getElementById("islandTickerSmall");
const islandExpanded = document.getElementById("islandExpanded");
const islandChevron = document.getElementById("islandChevron");
const islandOpenShopBtn = document.getElementById("islandOpenShop");
const islandSendBtn = document.getElementById("islandSendLazuzu");
const islandPointsBtn = document.getElementById("islandPointsExchange");
const islandCollapseBtn = document.getElementById("islandCollapse");
const colorDots = document.querySelectorAll(".colorDot");

// --- rest of your data and functions (kept exactly) ---
const rules = [
{ id: 'no_hit', title: 'No hit', days: 1, points: 12.5, details: 'Do not physically hurt anyone, as a joke is ok +1 days.' },
{ id: 'no_scream', title: 'No scream', days: 5, points: 12.5, details: 'Speak calmly, only when you are excited or angry +5 days.' },
{ id: 'no_cry', title: 'No cry', days: 1, points: 12.5, details: 'Crying is not allowed +1 days.' },
{ id: 'zeyad_devices', title: 'Zeyad can no longer make you play with devices when you have days.', days: 20, points: 15, details: 'If Zeyad makes you play with devices when you have days, +20 days to Zeyad!' },
{ id: 'no_fetn', title: 'No fetn', days: 25, points: 15, details: 'Don\'t make FETN. If someone tells you “blip” please don’t tell or repeat it to anyone. +25 days.' },
{ id: 'no_bother', title: 'No bother', days: 5, points: 12.5, details: 'Respect others. Don’t annoy them. +5 days.' },
{ id: 'respect', title: 'You have to respect', days: 10, points: 12.5, details: 'Treat everyone kindly and with respect, always. +10 days.' },
{ id: 'no_listen', title: 'No listen', days: 25, points: 15, details: 'You have to listen! If not, +25 days.' },
{ id: 'play_zezo', title: 'Play with Zezo', days: 25, points: 15, details: 'You must play with Zezo. If not, +25 days.' },
{ id: 'no_sad', title: 'No sad', days: 10, points: 12.5, details: 'Don’t be sad or +10 days.' },
{ id: 'no_devices', title: 'No devices when u have days = 5 days', days: 5, points: 12.5, details: 'When you have days, don’t use devices. Each minute = +5 days!' },
{ id: 'no_copy', title: 'No copy', days: 25, points: 15, details: 'You need proof (note, message) that someone gave you permission to copy them.' },
{ id: 'no_angry', title: 'No angry', days: 5, points: 12.5, details: 'Don’t be mad +5 days.' },
{ id: 'no_askzezo', title: 'dont asks zezo', days: 15, points: 12.5, details: 'Don’t ask zezo about any events or discord all instructions are put +15 days.' },
{ id: 'dont_ask_zeyad', title: 'DONT ASK ZEYAD TO MAKE YOU PLAY WITH DEVICES IF YOU HAVE DAYS', days: 25, points: 15, details: 'DONT ASK ZEYAD TO MAKE YOU PLAY WITH DEVICES IF YOU HAVE DAYS +50 DAYS' },
{ id: 'no_lie', title: 'No lie', days: 25, points: 15, details: 'Do not lie, always tell the truth. +25 days.' },
{ id: 'no_pause', title: 'No pause', days: 10, points: 12.5, details: 'No pauses. +10 days.' },
    { id: 'no_pinch', title: 'No pinch', days: 15, points: 12.5, details: 'No pinch. +15 days.' },
{ id: 'no_push', title: 'No push', days: 10, points: 12.5, details: 'No push. +10 days.' },
{ id: 'no_scare', title: 'No scare', days: 10, points: 12.5, details: 'No scare. +10 days.' },
    { id: 'no_dumb', title: 'No dumb', days: 15, points: 15, details: 'No dumb. +15 days.' },
{ id: 'no_discord', title: 'no discord', days: 25, points: 12.5, details: 'if you dont see discord labubu messgaes +25 days.' },
{ id: 'no_3ADY', title: 'No 3ADY', days: 25, points: 15, details: 'No 3ADY or he can reort on you 3ADY. +25 days.' }
];


const shopItems = [
{ cost: 200, days: 1 },
{ cost: 550, days: 5 },
{ cost: 1550, days: 15 },
{ cost: 2550, days: 25 },
{ cost: 3550, days: 35 },
{ cost: 4550, days: 45 },
{ cost: 5550, days: 55 },
{ cost: 6550, days: 65 },
{ cost: 7550, days: 75 },
{ cost: 9050, days: 85, points: 60},
{ cost: 10550, days: 100, points: 75}

];

const pointsExchangeItems = [
{ points: 100, credits: 500 },
{ points: 500, credits: 5500 },
{ points: 1000, credits: 12000 },
{ points: 2000, credits: 24000 },
{ points: 3000, credits: 37000 },
{ points: 4000, credits: 50000 },
];


// === CORE FUNCTIONS ===

function renderRules() {
  const container = document.getElementById('rulesList');
  container.innerHTML = '';
  rules.forEach((r, i) => {
    const div = document.createElement('div');
    div.className = 'rule-item';
    div.dataset.id = r.id;
    div.dataset.days = r.days;
    div.dataset.points = r.points;

    const textContainer = document.createElement('div');
    textContainer.style.flex = "1";
    textContainer.innerHTML = `<strong>${r.title}</strong><div class="rule-details">${r.details}</div>`;

    const qtyInput = document.createElement('input');
    qtyInput.type = 'number';
    qtyInput.min = 0;
    qtyInput.value = 0;
    qtyInput.className = 'rule-qty';
    qtyInput.addEventListener('input', updateTotalDays);

    div.appendChild(textContainer);
    div.appendChild(qtyInput);

    div.addEventListener('click', (e) => {
      if (e.target.tagName.toLowerCase() !== 'input') {
        div.classList.toggle('selected');
        if (div.classList.contains('selected') && qtyInput.value == 0) {
          qtyInput.value = 1;
        } else if (!div.classList.contains('selected')) {
          qtyInput.value = 0;
        }
        updateTotalDays();
      }
    });

    container.appendChild(div);
    if (i < rules.length - 1) {
      const hr = document.createElement('hr');
      hr.style.margin = '5px 0';
      container.appendChild(hr);
    }
  });
}
renderRules();


function updateTotalDays() {
  let total = 0;
  document.querySelectorAll('.rule-item').forEach(item => {
    const qty = parseInt(item.querySelector('input').value) || 0;
    const daysPerOffense = parseInt(item.dataset.days);
    total += daysPerOffense * qty;
  });
  document.getElementById('total-days').textContent = `Total Days Penalty: ${total}`;
}

async function loadUsersDropdowns() {
  const snap = await get(ref(db, "users"));
  if (snap.exists()) {
    reportedUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
    sendToUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
    Object.keys(snap.val()).forEach(user => {
      reportedUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
      if (user !== currentUser) sendToUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
    });
  }
}

async function login(username, password, keep, isAutoLogin = false) {
  const userRef = ref(db, `users/${username}`);
  const snap = await get(userRef);
  if (!snap.exists()) return alert("User not found");
  const data = snap.val();
  if (data.password !== password) return alert("Incorrect password");

  currentUser = username;
  currentUserData = data;

  const signature = data.signature || null;
  const expiry = signature?.expiry || 0;
  const lastLogin = data.lastLogin || 0;

  if (!signature || expiry <= Date.now()) {
    await update(userRef, { days: 0, credits: 0, points: 0, signature: null, lastLogin: Date.now() });
    alert("Your signature expired or not found. You need to create a new signature now.");
    window.location.href = "signature.html?user=" + encodeURIComponent(username);
    return;
  }

  const now = new Date();
  const lastLoginDate = new Date(lastLogin);

  function getMidnight(d) {
    return new Date(d.getFullYear(), d.getMonth(), d.getDate());
  }

  const nowMidnight = getMidnight(now);
  const lastLoginMidnight = getMidnight(lastLoginDate);
  const msPerDay = 1000 * 60 * 60 * 24;
  let daysPassed = 0;
  if (lastLogin) {
    daysPassed = Math.floor((nowMidnight - lastLoginMidnight) / msPerDay);
  }

  let updatedDays = (data.days || 0) - daysPassed;
  if (updatedDays < 0) updatedDays = 0;

  const msLeft = expiry - Date.now();
  const sigDaysLeft = Math.ceil(msLeft / msPerDay);
  const displayDaysLeft = sigDaysLeft > 0 ? sigDaysLeft : 0;

  await update(userRef, {
    days: updatedDays,
    lastLogin: Date.now()
  });

  currentUserData.days = updatedDays;
  currentUserData.lastLogin = Date.now();

  if (!isAutoLogin) {
    welcomeText.textContent = `Welcome back, ${username}!`;
    welcomeOverlay.style.display = "flex";
    await new Promise(resolve => {
      function onClick() {
        welcomeOverlay.removeEventListener("click", onClick);
        welcomeAudio.play();
        welcomeOverlay.style.transition = "opacity 0.7s ease";
        welcomeOverlay.style.opacity = 0;
        setTimeout(() => {
          welcomeOverlay.style.display = "none";
          welcomeOverlay.style.opacity = 1;
          resolve();
        }, 700);
      }
      welcomeOverlay.addEventListener("click", onClick);
    });
  }

  document.getElementById("login-form").style.display = "none";
  document.getElementById("report-form").style.display = "block";
  document.getElementById("action-buttons").style.display = "block";
  document.getElementById("user-info").style.display = "block";
  logoutBtn.style.display = "inline-block";
  reporterInput.value = username;
  daysSpan.textContent = updatedDays;
  creditsSpan.textContent = data.credits || 0;
  pointsSpan.textContent = data.points || 0;
  sigDaysLeftSpan.textContent = displayDaysLeft;

  // update island initially with user info
  refreshIslandTicker();

  await loadUsersDropdowns();
}

function logout() {
  currentUser = null;
  currentUserData = null;
  localStorage.removeItem("loginData");
  sessionStorage.removeItem("loginData");
  document.getElementById("login-form").style.display = "block";
  document.getElementById("report-form").style.display = "none";
  document.getElementById("action-buttons").style.display = "none";
  document.getElementById("user-info").style.display = "none";
  logoutBtn.style.display = "none";
}

/* shop rendering (kept) */
function renderShopItems() {
  const shopContainer = document.getElementById('shopItems');
  shopContainer.innerHTML = '';
  shopItems.forEach(item => {
    shopContainer.innerHTML += `
      <button onclick="buyItem(${item.cost}, ${item.days})">Buy: ${item.cost} LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove ${item.days} days</button><br>
    `;
  });
}
renderShopItems();

/* points exchange rendering (kept) */
function renderPointsExchangeItems() {
  const exchangeContainer = document.getElementById('pointsExchangeItems');
  exchangeContainer.innerHTML = '';
  pointsExchangeItems.forEach(item => {
    exchangeContainer.innerHTML += `
      <button onclick="exchangePoints(${item.points}, ${item.credits})">Exchange ${item.points} Points → ${item.credits} LAZUZU</button><br>
    `;
  });
}
renderPointsExchangeItems();

document.getElementById("loginBtn").onclick = () => {
  const username = document.getElementById("username").value.trim();
  const password = document.getElementById("password").value.trim();
  const keep = document.getElementById("keepSignedIn").checked;
  if (!username || !password) return alert("Please enter username and password.");

  if (keep) {
    localStorage.setItem("loginData", JSON.stringify({ username, password }));
    sessionStorage.removeItem("loginData");
  } else {
    sessionStorage.setItem("loginData", JSON.stringify({ username, password }));
    localStorage.removeItem("loginData");
  }

  login(username, password, keep);
};

logoutBtn.onclick = logout;

window.addEventListener("load", () => {
  let saved = localStorage.getItem("loginData") || sessionStorage.getItem("loginData");
  if (saved) {
    try {
      const { username, password } = JSON.parse(saved);
      login(username, password, true, true);
    } catch (e) {
      console.error("Failed to parse saved login:", e);
    }
  }

  // restore island color from localStorage
  const savedColor = localStorage.getItem('diColor');
  if (savedColor) {
    dynamicIsland.style.background = savedColor;
  }
});

document.getElementById("reportForm").onsubmit = async e => {
  e.preventDefault();
  if (!currentUser) return alert("Please login first.");
  const reportedUser = reportedUserSelect.value;
  if (!reportedUser) return alert("Please select the user you want to report.");

  const selectedRules = [];
  let totalDays = 0;
  let totalPoints = 0;
  document.querySelectorAll('.rule-item').forEach(item => {
    const qty = parseInt(item.querySelector('input').value) || 0;
    if (qty > 0) {
      const daysPerOffense = parseInt(item.dataset.days);
      const pointsPerOffense = parseInt(item.dataset.points);
      selectedRules.push({
        id: item.dataset.id,
        title: item.querySelector('strong').textContent,
        qty: qty,
        daysPerOffense: daysPerOffense,
        pointsPerOffense: pointsPerOffense
      });
      totalDays += daysPerOffense * qty;
      totalPoints += pointsPerOffense * qty;
    }
  });

  if (selectedRules.length === 0) return alert("Please select at least one rule broken.");

  const report = {
    reporter: currentUser,
    reportedUser,
    rules: selectedRules,
    totalDays,
    totalPoints,
    timestamp: Date.now()
  };

  try {
    const autoAcceptSnap = await get(ref(db, "settings/autoAcceptReports"));
    const autoAccept = autoAcceptSnap.exists() && autoAcceptSnap.val() === true;

    if (autoAccept) {
      const reportedUserRef = ref(db, `users/${reportedUser}`);
      const reporterUserRef = ref(db, `users/${currentUser}`);

      const [reportedUserSnap, reporterUserSnap] = await Promise.all([
        get(reportedUserRef),
        get(reporterUserRef)
      ]);

      const reportedUserData = reportedUserSnap.val();
      const reporterUserData = reporterUserSnap.val();

      const newReportedDays = (Number(reportedUserData.days || 0) + Number(totalDays));
      const newReporterPoints = (Number(reporterUserData.points || 0) + Number(totalPoints));

      const updates = {};
      updates[`users/${reportedUser}/days`] = newReportedDays;
      updates[`users/${currentUser}/points`] = newReporterPoints;
      await update(ref(db), updates);

      currentUserData.points = newReporterPoints;
      pointsSpan.textContent = currentUserData.points;

      alert(`Report auto accepted: ${totalDays} days added to ${reportedUser}, and you received ${totalPoints} points.`);
    } else {
      const newReportRef = push(ref(db, "reports"));
      await update(newReportRef, report);
      alert("Report submitted for manual approval. You will receive points upon approval.");
    }

    // Reset form and UI
    document.getElementById("reportForm").reset();
    renderRules();
    updateTotalDays();

  } catch (error) {
    console.error("Error submitting report:", error);
    alert("Failed to submit report: " + error.message);
  }
};

// SHOP & CREDITS FUNCTIONS (kept)
function togglePanel(id) {
  const el = document.getElementById(id);
  el.classList.toggle("show");
}
window.togglePanel = togglePanel;

async function buyItem(cost, daysToRemove) {
  if (!currentUser) return alert("Please login first.");
  if ((currentUserData.credits || 0) < cost) return alert("Not enough credits.");
  if ((currentUserData.days || 0) < daysToRemove) return alert(`You don't have enough days to remove (${daysToRemove} required).`);

  const applePayAudio = document.getElementById("applePayAudio");
  try {
    await applePayAudio.play();
  } catch (e) {
    console.error("Audio play failed:", e);
  }

  try {
    // Calculate the credit distribution
    const bankAmount = Math.floor(cost * 0.90); // 70% to 'bank'
    const zezoAmount = cost - bankAmount; // Remaining 30% to 'zezo'

    const userRef = ref(db, `users/${currentUser}`);
    const bankRef = ref(db, `users/bank`); // Reference for user 'bank'
    const zezoRef = ref(db, `users/zezo`); // Reference for user 'zezo'

    const [bankSnap, zezoSnap] = await Promise.all([
      get(bankRef),
      get(zezoRef)
    ]);

    const bankData = bankSnap.exists() ? bankSnap.val() : { credits: 0 };
    const zezoData = zezoSnap.exists() ? zezoSnap.val() : { credits: 0 };

    const updates = {};
    updates[`users/${currentUser}/credits`] = (currentUserData.credits || 0) - cost;
    updates[`users/${currentUser}/days`] = (currentUserData.days || 0) - daysToRemove;
    updates[`users/bank/credits`] = (bankData.credits || 0) + bankAmount;
    updates[`users/zezo/credits`] = (zezoData.credits || 0) + zezoAmount;

    await update(ref(db), updates);

    // Update local data and UI
    currentUserData.credits -= cost;
    currentUserData.days -= daysToRemove;

    creditsSpan.textContent = currentUserData.credits;
    daysSpan.textContent = currentUserData.days;

    alert(`Bought item for ${cost} credits. Removed ${daysToRemove} days. 70% went to Bank and 30% went to Zezo.`);

    // refresh island info
    refreshIslandTicker();

  } catch (error) {
    console.error("Error buying item:", error);
    alert("Failed to complete purchase: " + error.message);
  }
}
window.buyItem = buyItem;

async function exchangePoints(pointsToExchange, creditsToReceive) {
  if (!currentUser) return alert("Please login first.");
  if ((currentUserData.points || 0) < pointsToExchange) return alert("Not enough points to make this exchange.");

  const newPoints = (currentUserData.points || 0) - pointsToExchange;
  const newCredits = (currentUserData.credits || 0) + creditsToReceive;

  try {
    const userRef = ref(db, `users/${currentUser}`);
    await update(userRef, {
      points: newPoints,
      credits: newCredits
    });

    currentUserData.points = newPoints;
    currentUserData.credits = newCredits;
    pointsSpan.textContent = currentUserData.points;
    creditsSpan.textContent = currentUserData.credits;

    alert(`Exchanged ${pointsToExchange} points for ${creditsToReceive} credits!`);

    // refresh island info
    refreshIslandTicker();

  } catch (error) {
    console.error("Error exchanging points:", error);
    alert("Failed to complete exchange.");
  }
}
window.exchangePoints = exchangePoints;

async function sendCredits() {
  if (!currentUser) return alert("Please login first.");
  const toUser = sendToUserSelect.value;
  const amount = parseInt(document.getElementById("sendAmount").value);
  if (!toUser) return alert("Select a user to send credits to.");
  if (!amount || amount <= 0) return alert("Enter a valid amount.");

  if ((currentUserData.credits || 0) < amount) return alert("Not enough credits.");

  const senderRef = ref(db, `users/${currentUser}`);
  const receiverRef = ref(db, `users/${toUser}`);

  try {
    const receiverSnap = await get(receiverRef);
    if (!receiverSnap.exists()) return alert("Receiver user not found.");
    const receiverCredits = receiverSnap.val().credits || 0;

    const updates = {};
    updates[`users/${currentUser}/credits`] = (currentUserData.credits || 0) - amount;
    updates[`users/${toUser}/credits`] = receiverCredits + amount;

    await update(ref(db), updates);

    currentUserData.credits -= amount;
    creditsSpan.textContent = currentUserData.credits;

    alert(`Sent ${amount} credits to ${toUser}.`);

    // refresh island info
    refreshIslandTicker();

  } catch (error) {
    console.error("Error sending credits:", error);
    alert("Failed to send credits.");
  }
}
window.sendCredits = sendCredits;

// === EVENTS SECTION LOGIC ===
function formatCountdown(msLeft) {
  if (msLeft <= 0) return "Expired";

  const totalSeconds = Math.floor(msLeft / 1000);
  const days = Math.floor(totalSeconds / (24 * 3600));
  const hours = Math.floor((totalSeconds % (24 * 3600)) / 3600);
  const minutes = Math.floor((totalSeconds % 3600) / 60);
  const seconds = totalSeconds % 60;

  let parts = [];
  if (days > 0) parts.push(`${days}d`);
  if (hours > 0 || days > 0) parts.push(`${hours}h`);
  if (minutes > 0 || hours > 0 || days > 0) parts.push(`${minutes}m`);
  parts.push(`${seconds}s`);

  return parts.join(" ");
}

const eventsRef = ref(db, "events");

function renderEvents(events) {
  eventsListEl.innerHTML = "";
  const now = Date.now();
  let hasEvents = false;

  Object.entries(events || {}).forEach(([eventId, ev]) => {
    if (!ev.endTime || now > ev.endTime) {
      remove(ref(db, `events/${eventId}`));
      return;
    }
    hasEvents = true;

    const div = document.createElement("div");
    div.className = "event-item";

    const titleEl = document.createElement("h4");
    titleEl.textContent = ev.title;
    div.appendChild(titleEl);

    const detailsEl = document.createElement("p");
    detailsEl.textContent = ev.description;
    div.appendChild(detailsEl);

    const countdownEl = document.createElement("p");
    countdownEl.className = "countdown";
    div.appendChild(countdownEl);

    function updateCountdown() {
      const msLeft = ev.endTime - Date.now();
      if (msLeft <= 0) {
        countdownEl.textContent = "Time left: Expired";
        remove(ref(db, `events/${eventId}`));
        return;
      }
      countdownEl.textContent = `Time left: ${formatCountdown(msLeft)}`;
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);

    eventsListEl.appendChild(div);
  });

  if (!hasEvents) {
    eventsListEl.textContent = "No active events at this time.";
  }
}

onValue(eventsRef, (snapshot) => {
  const events = snapshot.val();
  renderEvents(events);
});

/* ========== Dynamic Island behavior (updated) ========== */

/*
 - No click toggle. ONLY pointer (touch/mouse drag) slide down/up.
 - Small-screen sizing applied in CSS.
 - Bounce animation applied after open/close.
*/

const islandState = {
  expanded: false,
  tickerIndex: 0,
  tickerInterval: null,
  tickers: []
};

function getCairoTime() {
  try {
    const now = new Date();
    const opts = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false, timeZone: 'Africa/Cairo' };
    return new Intl.DateTimeFormat([], opts).format(now);
  } catch (e) {
    return new Date().toLocaleTimeString();
  }
}

function refreshIslandTicker() {
  const localTime = getCairoTime();
  const days = (currentUserData && currentUserData.days != null) ? currentUserData.days : (document.getElementById('days-count')?.textContent || '0');
  const credits = (currentUserData && currentUserData.credits != null) ? currentUserData.credits : (document.getElementById('credits-count')?.textContent || '0');
  const points = (currentUserData && currentUserData.points != null) ? currentUserData.points : (document.getElementById('points-count')?.textContent || '0');
  const sigDays = (currentUserData && currentUserData.signature && currentUserData.signature.expiry) ? Math.max(Math.ceil((currentUserData.signature.expiry - Date.now())/(1000*60*60*24)),0) : document.getElementById('sig-days-left')?.textContent || '0';

  const msgA = `${localTime} — Days: ${days} | LAZUZU: ${credits}`;
  const msgB = `Points: ${points} | Signature Days Left: ${sigDays}`;

  islandState.tickers = [msgA, msgB];
  islandTicker.textContent = islandState.tickers[islandState.tickerIndex];
}

function startTickerRotation() {
  if (islandState.tickerInterval) clearInterval(islandState.tickerInterval);
  islandState.tickerInterval = setInterval(() => {
    islandState.tickerIndex = (islandState.tickerIndex + 1) % (islandState.tickers?.length || 2);
    islandTicker.textContent = islandState.tickers[islandState.tickerIndex];
  }, 10000);
}

function expandIsland(withBounce = true) {
  if (islandState.expanded) return;
  dynamicIsland.classList.remove('closed');
  dynamicIsland.classList.add('expanded');
  islandExpanded.style.display = 'grid';
  islandState.expanded = true;
  document.body.classList.add('with-island');
  if (withBounce) {
    // bounce down effect
    dynamicIsland.classList.remove('dynamic-bounce-up');
    void dynamicIsland.offsetWidth;
    dynamicIsland.classList.add('dynamic-bounce-down');
    dynamicIsland.addEventListener('animationend', () => dynamicIsland.classList.remove('dynamic-bounce-down'), { once: true });
  }
  islandChevron.style.transform = 'rotate(180deg)';
}

function collapseIsland(withBounce = true) {
  if (!islandState.expanded) return;
  dynamicIsland.classList.add('closed');
  dynamicIsland.classList.remove('expanded');
  islandExpanded.style.display = 'none';
  islandState.expanded = false;
  document.body.classList.remove('with-island');
  if (withBounce) {
    dynamicIsland.classList.remove('dynamic-bounce-down');
    void dynamicIsland.offsetWidth;
    dynamicIsland.classList.add('dynamic-bounce-up');
    dynamicIsland.addEventListener('animationend', () => dynamicIsland.classList.remove('dynamic-bounce-up'), { once: true });
  }
  islandChevron.style.transform = 'rotate(0deg)';
}

// wire island buttons to your existing functions
islandOpenShopBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePanel('shopContainer'); });
islandSendBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePanel('creditsSenderContainer'); });
islandPointsBtn.addEventListener('click', (e) => { e.stopPropagation(); togglePanel('pointsExchangeContainer'); });

// collapse via close button (still works)
islandCollapseBtn.addEventListener('click', (e) => {
  e.stopPropagation();
  collapseIsland(true);
});

// color pickers
colorDots.forEach(dot => {
  dot.addEventListener('click', (ev) => {
    ev.stopPropagation();
    const color = dot.dataset.color;
    dynamicIsland.style.background = color;
    localStorage.setItem('diColor', color);
  });
});

// POINTER drag implementation (works for touch and mouse)
// Only allow vertical dragging to open/close island. No click toggles.
let isPointerDown = false;
let startY = 0;
let currentY = 0;
let lastTranslate = 0;

const DRAG_THRESHOLD = 80; // px to trigger open/close

dynamicIsland.addEventListener('pointerdown', (ev) => {
  // Only start drag if pointer is primary
  if (!ev.isPrimary) return;
  isPointerDown = true;
  startY = ev.clientY;
  currentY = startY;
  lastTranslate = 0;
  // capture pointer so we receive move/up outside element
  dynamicIsland.setPointerCapture(ev.pointerId);
  // temporarily disable transitions so dragging feels direct
  dynamicIsland.style.transition = 'none';
});

dynamicIsland.addEventListener('pointermove', (ev) => {
  if (!isPointerDown) return;
  currentY = ev.clientY;
  const dy = currentY - startY;
  // If island is closed, allow downward dragging only
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  if (!isPointerDown) return;
  // Decide allowed movement
  if (!isPointerDown) return;
  // only permit vertical translation; small resistance if opposite direction
  if (!isPointerDown) return;
  // Simplify: if island not expanded, allow translate positive (down) up to 220px
  if (!isPointerDown) return;
  // Implementation:
  const translateY = (() => {
    if (!isPointerDown) return 0;
    if (!isPointerDown) return 0;
    if (!isPointerDown) return 0;
    // closed -> accept dy > 0 (down)
    if (!isPointerDown) return 0;
  })();

  // The above repeated guards are redundant but harmless - we will compute dy properly now:
  // compute dy and clamp
  let clamped;
  if (!isPointerDown) clamped = 0; // fallback
  else {
    if (!isPointerDown) clamped = 0;
    clamped = Math.max(Math.min(dy, 220), -220);
  }

  // If closed and user drags up (negative), show slight resistance (small upward movement)
  if (!isPointerDown) {} // noop

  // Apply transform for visual feedback
  dynamicIsland.style.transform = `translateY(${clamped}px)`;
  lastTranslate = clamped;
});

dynamicIsland.addEventListener('pointerup', (ev) => {
  if (!isPointerDown) return;
  isPointerDown = false;
  dynamicIsland.releasePointerCapture(ev.pointerId);
  // restore transition
  dynamicIsland.style.transition = 'transform 0.28s cubic-bezier(.2,.9,.3,1), height 0.28s ease';
  // decide whether to expand/collapse based on lastTranslate
  const finalDY = lastTranslate;
  // Reset transform (we'll run bounce after state change)
  dynamicIsland.style.transform = '';
  // If island was closed and dragged down enough -> expand
  if (!islandState.expanded && finalDY > DRAG_THRESHOLD) {
    expandIsland(true);
  } else if (islandState.expanded && finalDY < -DRAG_THRESHOLD) {
    // if expanded and dragged up enough -> collapse
    collapseIsland(true);
  } else {
    // if not crossing threshold -> snap back to previous state with tiny bounce
    if (islandState.expanded) {
      // ensure it's in expanded visual state
      dynamicIsland.classList.add('expanded');
      islandExpanded.style.display = 'grid';
      // small settle bounce for user feedback
      dynamicIsland.classList.remove('dynamic-bounce-down');
      void dynamicIsland.offsetWidth;
      dynamicIsland.classList.add('dynamic-bounce-down');
      dynamicIsland.addEventListener('animationend', () => dynamicIsland.classList.remove('dynamic-bounce-down'), { once: true });
    } else {
      dynamicIsland.classList.add('closed');
      islandExpanded.style.display = 'none';
      dynamicIsland.classList.remove('dynamic-bounce-up');
      void dynamicIsland.offsetWidth;
      dynamicIsland.classList.add('dynamic-bounce-up');
      dynamicIsland.addEventListener('animationend', () => dynamicIsland.classList.remove('dynamic-bounce-up'), { once: true });
    }
  }
  lastTranslate = 0;
});

// Also handle lostpointercapture / cancel events to reset state
dynamicIsland.addEventListener('pointercancel', (ev) => {
  if (!isPointerDown) return;
  isPointerDown = false;
  try { dynamicIsland.releasePointerCapture(ev.pointerId); } catch (e) {}
  dynamicIsland.style.transition = 'transform 0.28s cubic-bezier(.2,.9,.3,1), height 0.28s ease';
  dynamicIsland.style.transform = '';
  lastTranslate = 0;
});

// ensure ticker updates periodically and when user data changes
refreshIslandTicker();
startTickerRotation();

// also refresh ticker every 3s to keep local time ticking
setInterval(() => {
  refreshIslandTicker();
}, 3000);

/* ========== remaining script (discord webhook and last small script kept as-is) ========== */
</script>

<script>
/* Keep the webhook code exactly as you had it, only now it works with the dynamic island UI */
document.getElementById("reportForm").addEventListener("submit", function(e) {
    e.preventDefault(); // stop form refresh

    const webhookURL = "https://discordapp.com/api/webhooks/1404606217346875483/XRsgBkh2jdg7NgOgH77wnmDB5sxtYwEHzMRMy-SDHeC1x-NX8n4y2pv1Y3mZvK92a9LL";
    const reporter = document.getElementById("reporter").value.trim();
    const reportedUser = document.getElementById("reportedUser").value.trim();
   
    // Get the total days penalty from the correct element (which is a div)
    const totalDaysText = document.getElementById("total-days").textContent;
    const totalDays = totalDaysText.match(/\d+/)[0] || "0";

    // Create a list of the rules that were broken, including the penalty days and quantity
    const brokenRules = [];
    document.querySelectorAll('.rule-item').forEach(item => {
        const qty = parseInt(item.querySelector('input').value) || 0;
        if (qty > 0) {
            const title = item.querySelector('strong').textContent;
            const daysPer = parseInt(item.dataset.days);
            brokenRules.push(`- ${title} (x${qty}) for ${qty * daysPer} days`);
        }
    });
    const rulesList = brokenRules.join('\n') || "No rules specified.";


    // Map reported users to Discord mentions
    const mentionMap = {
        "layan": "<@1367185737446985738>", // Replace with actual user IDs
        "zezo": "<@1388958062500647064>", // Replace with actual user IDs
        "asser": "<@1367187821542117558>" // Replace with actual user IDs
    };

    const mention = mentionMap[reportedUser.toLowerCase()] || "";

    const message = `📢 **New Report Submitted**\n`
                  + `**Reporter:** ${reporter}\n`
                  + `**Reported User:** ${reportedUser} ${mention}\n`
                  + `**Broken Rules:**\n${rulesList}\n`
                  + `**Total Days:** ${totalDays}`;

    fetch(webhookURL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ content: message })
    })
    .then(res => {
        if (res.ok) {
            alert("Report sent successfully!");
        } else {
            alert("Failed to send report.");
        }
    })
    .catch(err => {
        console.error(err);
        alert("Error sending report.");
    });
});
</script>
</body>
</html>
