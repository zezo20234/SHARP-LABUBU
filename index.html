<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Login, Report, Shop & Credits Sender with Signature</title>
<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#2b4c7e" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />

<!-- Viewport for mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />

<style>
body {
    font-family: Arial, sans-serif;
    max-width: 700px;
    margin: 30px auto;
    padding: 10px;
    background: linear-gradient(135deg, #f0f4f9, #d9e4f5);
    color: #333;
    font-size: 1rem;
    line-height: 1.4;
}

@media (max-width: 700px) {
  body {
    max-width: 100%;
    margin: 10px;
    padding: 10px 15px;
  }
}

h2, h3 { color: #2b4c7e; margin-bottom: 10px; }

button, input, select {
    width: 100%;
    max-width: 100%;
    padding: 12px;
    margin-top: 6px;
    font-size: 1.1rem;
    box-sizing: border-box;
    border-radius: 6px;
    border: 1px solid #ccc;
    touch-action: manipulation;
}

button {
    background: #2b4c7e;
    color: white;
    cursor: pointer;
    user-select: none;
}

button:hover {
    background: #1f3557;
}

#user-info {
    position: fixed; top: 10px; left: 10px;
    background: white;
    padding: 10px 15px;
    border-radius: 8px;
    font-weight: bold;
    display: none;
    z-index: 100;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    max-width: calc(100vw - 20px);
    word-wrap: break-word;
}

@media (max-width: 500px) {
    #user-info {
      font-size: 0.9rem;
      padding: 8px 10px;
      top: auto;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 95vw;
      text-align: center;
    }
}

#logoutBtn {
    background: #e74c3c;
    margin-top: 8px;
    font-size: 0.9rem;
    padding: 8px;
}

#logoutBtn:hover {
    background: #c0392b;
}

#login-form, #report-form {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}

label {
    font-weight: bold;
    margin-top: 15px;
    display: block;
}

.rules-list {
    margin-top: 10px;
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #ccc;
    padding: 10px;
    border-radius: 6px;
    background: #fafafa;
}

.rule-item {
    padding: 8px;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.rule-item:hover {
    background: #e6f0ff;
}
.rule-item.selected {
    background: #2b4c7e;
    color: white;
}

.rule-details {
    font-size: 0.9rem;
    color: inherit;
    margin-top: 4px;
    flex-basis: 100%;
}

.rule-qty {
    width: 50px;
    margin-left: 10px;
    font-size: 1rem;
}

.action-buttons {
    margin-top: 20px;
    text-align: center;
}
.action-buttons button {
    width: auto;
    padding: 10px 15px;
    margin: 5px;
    border-radius: 25px;
    font-weight: bold;
    font-size: 1rem;
    user-select: none;
}
.action-buttons button:nth-child(1) {
    background: #27ae60;
}
.action-buttons button:nth-child(1):hover {
    background: #1e8449;
}
.action-buttons button:nth-child(2) {
    background: #2980b9;
}
.action-buttons button:nth-child(2):hover {
    background: #1f6391;
}

#shopContainer, #creditsSenderContainer {
    border: 1px solid #ccc;
    padding: 15px;
    margin-top: 15px;
    border-radius: 8px;
    background: white;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transform: scaleY(0.9);
    transition: all 0.4s ease;
}
#shopContainer.show, #creditsSenderContainer.show {
    max-height: 800px;
    opacity: 1;
    transform: scaleY(1);
}

#welcomeOverlay {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(80, 80, 80, 0.7);
  color: white;
  font-size: 2rem;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 9999;
  cursor: pointer;
  text-align: center;
  padding: 20px;
}
#welcomeOverlay small {
  font-size: 1.2rem;
  margin-top: 15px;
  opacity: 0.8;
}
</style>
</head>
<body>

<!-- Welcome Overlay -->
<div id="welcomeOverlay">
  <div id="welcomeText"></div>
  <small>Click to continue</small>
</div>
<audio id="welcomeAudio" src="header-39344.mp3"></audio>

<div id="user-info">
    Days: <span id="days-count">0</span> | LAZUZU <img src="LAZUZU.jpg" style="width:1em;height:1em;vertical-align:middle;">: <span id="credits-count">0</span> | Signature Days Left: <span id="sig-days-left">0</span>
    <button id="logoutBtn" style="display:none;">Logout</button>
</div>

<div id="login-form">
    <h2>Login</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <label><input type="checkbox" id="keepSignedIn"> Keep me signed in</label>
    <button id="loginBtn">Login</button>
</div>

<div id="report-form" style="display:none;">
    <h2>Report Form</h2>
    <form id="reportForm">
        <label>Your Username</label>
        <input type="text" id="reporter" readonly />
        <label>Who is this report on?</label>
        <select id="reportedUser" required></select>
        <label>Rules broken:</label>
        <div class="rules-list" id="rulesList"></div>
        <div id="total-days">Total Days Penalty: 0</div>
        <button type="submit" style="margin-top:20px;">Submit Report</button>
    </form>
</div>

<div class="action-buttons" id="action-buttons" style="display:none;">
    <hr>
    <button onclick="togglePanel('shopContainer')">Toggle Shop</button>
    <button onclick="togglePanel('creditsSenderContainer')">Toggle Send LAZUZU <img src="LAZUZU.jpg" style="width:1em;height:1em;vertical-align:middle;"></button>
</div>

<div id="shopContainer">
    <h3>- Days Shop (Spend LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> to reduce days)</h3>
    <button onclick="buyItem(1000, 5)">Buy: 1000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 5 days</button><br>
    <button onclick="buyItem(2000, 15)">Buy: 2000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 15 days</button><br>
    <button onclick="buyItem(4000, 25)">Buy: 4000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 25 days</button><br>
    <button onclick="buyItem(5000, 35)">Buy: 5000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 35 days</button><br>
    <button onclick="buyItem(6000, 45)">Buy: 6000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 45 days</button><br><br>
    <button onclick="buyItem(7000, 55)">Buy: 7000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 55 days</button><br><br>
    <button onclick="buyItem(8000, 65)">Buy: 8000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 65 days</button><br><br>
    <button onclick="buyItem(9000, 75)">Buy: 9000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 75 days</button><br><br>
    <button onclick="buyItem(10000, 85)">Buy: 10000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 85 days</button><br><br>
    <button onclick="buyItem(11000, 100)">Buy: 11000 LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"> → Remove 100 days</button><br><br>
</div>


<div id="creditsSenderContainer">
    <h3>Send LAZUZU <img src="LAZUZU.jpg" style="width:2em;height:2em;vertical-align:middle;"></h3>
    <label>Send to:</label>
    <select id="sendToUser"></select>
    <label>Amount:</label>
    <input type="number" id="sendAmount" min="1" />
    <button onclick="sendCredits()">Send</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, get, update, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAjeXycCBhYoAU-0iiC4LbSTylKrrThN8Y",
    authDomain: "sharplabubu.firebaseapp.com",
    databaseURL: "https://sharplabubu-default-rtdb.firebaseio.com",
    projectId: "sharplabubu",
    storageBucket: "sharplabubu.firebasestorage.app",
    messagingSenderId: "596148393481",
    appId: "1:596148393481:web:4f822d86c44a13bd810ad8",
    measurementId: "G-4M25R3BF08"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let currentUser = null, currentUserData = null;
const daysSpan = document.getElementById("days-count");
const creditsSpan = document.getElementById("credits-count");
const sigDaysLeftSpan = document.getElementById("sig-days-left");
const reportedUserSelect = document.getElementById("reportedUser");
const sendToUserSelect = document.getElementById("sendToUser");
const reporterInput = document.getElementById("reporter");
const logoutBtn = document.getElementById("logoutBtn");

const welcomeOverlay = document.getElementById("welcomeOverlay");
const welcomeText = document.getElementById("welcomeText");
const welcomeAudio = document.getElementById("welcomeAudio");

const rules = [
    { id: 'no_hit', title: 'No hit', days: 1, details: 'Do not physically hurt anyone, as a joke is ok +1 days.' },
    { id: 'no_scream', title: 'No scream', days: 5, details: 'Speak calmly, only when you are excited or angry +5 days.' },
    { id: 'no_cry', title: 'No cry', days: 1, details: 'Crying is not allowed +1 days.' },
    { id: 'zeyad_devices', title: 'Zeyad can no longer make you play with devices when you have days.', days: 20, details: 'If Zeyad makes you play with devices when you have days, +20 days to Zeyad!' },
    { id: 'no_fetn', title: 'No fetn', days: 100, details: 'Don\'t make FETN. If someone tells you “blip” please don’t tell or repeat it to anyone. +100 days.' },
    { id: 'no_bother', title: 'No bother', days: 5, details: 'Respect others. Don’t annoy them. +5 days.' },
    { id: 'respect', title: 'You have to respect', days: 10, details: 'Treat everyone kindly and with respect, always. +10 days.' },
    { id: 'cute', title: 'CUTE +50 DAYS', days: 50, details: 'Be cute for 5 minutes = +50 days!' },
    { id: 'no_listen', title: 'No listen', days: 50, details: 'You have to listen! If not, +50 days.' },
    { id: 'play_zezo', title: 'Play with Zezo', days: 50, details: 'You must play with Zezo. If not, +50 days.' },
    { id: 'no_sad', title: 'No sad', days: 10, details: 'Don’t be sad or +10 days.' },
    { id: 'no_devices', title: 'No devices when u have days each minute = 5 days', days: 5, details: 'When you have days, don’t use devices. Each minute = +5 days!' },
    { id: 'no_copy', title: 'No copy', days: 100, details: 'You need proof (note, message) that someone gave you permission to copy them.' },
    { id: 'no_angry', title: 'No angry', days: 5, details: 'Don’t be mad +5 days.' },
    { id: 'dont_ask_zeyad', title: 'DONT ASK ZEYAD TO MAKE YOU PLAY WITH DEVICES IF YOU HAVE DAYS', days: 50, details: 'DONT ASK ZEYAD TO MAKE YOU PLAY WITH DEVICES IF YOU HAVE DAYS +50 DAYS' },
];

// Render rules list
function renderRules() {
    const container = document.getElementById('rulesList');
    container.innerHTML = '';
    rules.forEach((r, i) => {
        const div = document.createElement('div');
        div.className = 'rule-item';
        div.dataset.id = r.id;
        div.dataset.days = r.days;

        const textContainer = document.createElement('div');
        textContainer.style.flex = "1";
        textContainer.innerHTML = `<strong>${r.title}</strong><div class="rule-details">${r.details}</div>`;

        const qtyInput = document.createElement('input');
        qtyInput.type = 'number';
        qtyInput.min = 0;
        qtyInput.value = 0;
        qtyInput.className = 'rule-qty';
        qtyInput.addEventListener('input', updateTotalDays);

        div.appendChild(textContainer);
        div.appendChild(qtyInput);

        div.addEventListener('click', (e) => {
            if (e.target.tagName.toLowerCase() !== 'input') {
                div.classList.toggle('selected');
                if (div.classList.contains('selected') && qtyInput.value == 0) qtyInput.value = 1;
                else if (!div.classList.contains('selected')) qtyInput.value = 0;
                updateTotalDays();
            }
        });

        container.appendChild(div);
        if (i < rules.length - 1) container.appendChild(document.createElement('hr'));
    });
}

renderRules();

function updateTotalDays() {
    let total = 0;
    document.querySelectorAll('.rule-item').forEach(item => {
        const qty = parseInt(item.querySelector('input').value) || 0;
        const daysPerOffense = parseInt(item.dataset.days);
        total += daysPerOffense * qty;
    });
    document.getElementById('total-days').textContent = `Total Days Penalty: ${total}`;
}

async function loadUsersDropdowns() {
    const snap = await get(ref(db, "users"));
    if (snap.exists()) {
        reportedUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
        sendToUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
        Object.keys(snap.val()).forEach(user => {
            reportedUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
            if (user !== currentUser) sendToUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
        });
    }
}

async function login(username, password, keep) {
    const snap = await get(ref(db, `users/${username}`));
    if (!snap.exists()) return alert("User not found");
    const data = snap.val();
    if (data.password !== password) return alert("Incorrect password");

    // Check signature
    const sig = data.signature;
    let now = Date.now();
    let sigExpired = true;
    let daysLeft = 0;

    if (sig && sig.expiry) {
        const expiry = sig.expiry;
        if (expiry > now) {
            sigExpired = false;
            daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
        }
    }

    if (sigExpired) {
        // Reset user (clear days, credits, signature)
        await update(ref(db, `users/${username}`), {
            days: 0,
            credits: 0,
            signature: null
        });
        alert("Your signature expired or not found. You need to create a new signature now.");
        window.location.href = "signature.html?user=" + encodeURIComponent(username);
        return;
    }

    currentUser = username;
    currentUserData = data;

    // Show welcome overlay
    welcomeText.textContent = `Welcome back, ${username}!`;
    welcomeOverlay.style.display = "flex";

    // Wait for user click, play audio, then continue
    await new Promise(resolve => {
        function onClick() {
            welcomeOverlay.removeEventListener("click", onClick);
            welcomeAudio.play();
            // Hide overlay with fade out
            welcomeOverlay.style.transition = "opacity 0.7s ease";
            welcomeOverlay.style.opacity = 0;
            setTimeout(() => {
                welcomeOverlay.style.display = "none";
                welcomeOverlay.style.opacity = 1;
                resolve();
            }, 700);
        }
        welcomeOverlay.addEventListener("click", onClick);
    });

    // Show user info and main forms
    document.getElementById("login-form").style.display = "none";
    document.getElementById("report-form").style.display = "block";
    document.getElementById("action-buttons").style.display = "block";
    document.getElementById("user-info").style.display = "block";
    logoutBtn.style.display = "inline-block";
    reporterInput.value = username;
    daysSpan.textContent = data.days || 0;
    creditsSpan.textContent = data.credits || 0;
    sigDaysLeftSpan.textContent = daysLeft;
    await loadUsersDropdowns();
}

logoutBtn.onclick = () => {
    currentUser = null;
    currentUserData = null;
    document.getElementById("login-form").style.display = "block";
    document.getElementById("report-form").style.display = "none";
    document.getElementById("action-buttons").style.display = "none";
    document.getElementById("user-info").style.display = "none";
    logoutBtn.style.display = "none";
};

document.getElementById("loginBtn").onclick = () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const keep = document.getElementById("keepSignedIn").checked;
    if (!username || !password) return alert("Please enter username and password.");
    login(username, password, keep);
};

document.getElementById("reportForm").onsubmit = async e => {
    e.preventDefault();
    if (!currentUser) return alert("Please login first.");
    const reportedUser = reportedUserSelect.value;
    if (!reportedUser) return alert("Please select the user you want to report.");

    // Collect selected rules and total days
    const selectedRules = [];
    let totalDays = 0;
    document.querySelectorAll('.rule-item').forEach(item => {
        const qty = parseInt(item.querySelector('input').value) || 0;
        if (qty > 0) {
            selectedRules.push({
                id: item.dataset.id,
                title: item.querySelector('strong').textContent,
                qty: qty,
                daysPerOffense: parseInt(item.dataset.days)
            });
            totalDays += qty * parseInt(item.dataset.days);
        }
    });

    if (selectedRules.length === 0) return alert("Please select at least one rule broken.");

    // Create report object
    const report = {
        reporter: currentUser,
        reportedUser,
        rules: selectedRules,
        totalDays,
        timestamp: Date.now()
    };

    // Push report to Firebase
    await push(ref(db, "reports"), report);
    alert("Report submitted successfully!");

    // Reset form
    document.getElementById("reportForm").reset();
    renderRules();
    updateTotalDays();
};

// Toggle panels (shop, send credits)
function togglePanel(id) {
    const el = document.getElementById(id);
    el.classList.toggle("show");
}
window.togglePanel = togglePanel;

async function buyItem(cost, daysToRemove) {
    if (!currentUser) return alert("Please login first.");
    if ((currentUserData.credits || 0) < cost) return alert("Not enough credits.");
    if ((currentUserData.days || 0) < daysToRemove) return alert(`You don't have enough days to remove (${daysToRemove} required).`);

    // Update Firebase user credits and days (deduct credits and remove days)
    await update(ref(db, `users/${currentUser}`), {
        credits: (currentUserData.credits || 0) - cost,
        days: (currentUserData.days || 0) - daysToRemove
    });

    // Refresh data locally
    currentUserData.credits -= cost;
    currentUserData.days -= daysToRemove;

    creditsSpan.textContent = currentUserData.credits;
    daysSpan.textContent = currentUserData.days;

    alert(`Bought item for ${cost} credits. Removed ${daysToRemove} days.`);
}
window.buyItem = buyItem;


async function buyInfiniteCredits() {
    if (!currentUser) return alert("Please login first.");
    // Add 16000 credits and charge 2.5 seconds = 2.5 days?
    // You may want to adjust this logic
    await update(ref(db, `users/${currentUser}`), {
        credits: (currentUserData.credits || 0) + 16000,
        days: (currentUserData.days || 0) + 3
    });
    currentUserData.credits += 16000;
    currentUserData.days += 3;
    creditsSpan.textContent = currentUserData.credits;
    daysSpan.textContent = currentUserData.days;
    alert("Bought infinite credits (2.5s) for 16,000 credits.");
}
window.buyInfiniteCredits = buyInfiniteCredits;

async function sendCredits() {
    if (!currentUser) return alert("Please login first.");
    const toUser = sendToUserSelect.value;
    const amount = parseInt(document.getElementById("sendAmount").value);
    if (!toUser) return alert("Select a user to send credits to.");
    if (!amount || amount <= 0) return alert("Enter a valid amount.");

    if ((currentUserData.credits || 0) < amount) return alert("Not enough credits.");

    // Update sender and receiver credits
    const senderRef = ref(db, `users/${currentUser}`);
    const receiverRef = ref(db, `users/${toUser}`);

    // Atomic update
    const updates = {};
    updates[`users/${currentUser}/credits`] = currentUserData.credits - amount;

    // Fetch receiver credits first
    const receiverSnap = await get(receiverRef);
    if (!receiverSnap.exists()) return alert("Receiver user not found.");
    const receiverCredits = receiverSnap.val().credits || 0;

    updates[`users/${toUser}/credits`] = receiverCredits + amount;

    await update(ref(db), updates);

    currentUserData.credits -= amount;
    creditsSpan.textContent = currentUserData.credits;

    alert(`Sent ${amount} credits to ${toUser}.`);
}
window.sendCredits = sendCredits;

</script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, get, update, push } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAjeXycCBhYoAU-0iiC4LbSTylKrrThN8Y",
    authDomain: "sharplabubu.firebaseapp.com",
    databaseURL: "https://sharplabubu-default-rtdb.firebaseio.com",
    projectId: "sharplabubu",
    storageBucket: "sharplabubu.firebasestorage.app",
    messagingSenderId: "596148393481",
    appId: "1:596148393481:web:4f822d86c44a13bd810ad8",
    measurementId: "G-4M25R3BF08"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let currentUser = null, currentUserData = null;

  const daysSpan = document.getElementById("days-count");
  const creditsSpan = document.getElementById("credits-count");
  const sigDaysLeftSpan = document.getElementById("sig-days-left");
  const reportedUserSelect = document.getElementById("reportedUser");
  const sendToUserSelect = document.getElementById("sendToUser");
  const reporterInput = document.getElementById("reporter");
  const logoutBtn = document.getElementById("logoutBtn");

  const welcomeOverlay = document.getElementById("welcomeOverlay");
  const welcomeText = document.getElementById("welcomeText");
  const welcomeAudio = document.getElementById("welcomeAudio");

  // Load users into dropdowns
  async function loadUsersDropdowns() {
    const snap = await get(ref(db, "users"));
    if (snap.exists()) {
      reportedUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
      sendToUserSelect.innerHTML = `<option disabled selected>Select user</option>`;
      Object.keys(snap.val()).forEach(user => {
        reportedUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
        if (user !== currentUser) sendToUserSelect.innerHTML += `<option value="${user}">${user}</option>`;
      });
    }
  }

  // Login function
  async function login(username, password, keep) {
    const snap = await get(ref(db, `users/${username}`));
    if (!snap.exists()) return alert("User not found");
    const data = snap.val();
    if (data.password !== password) return alert("Incorrect password");

    // Check signature expiration
    const sig = data.signature;
    const now = Date.now();
    let sigExpired = true;
    let daysLeft = 0;

    if (sig && sig.expiry && sig.expiry > now) {
      sigExpired = false;
      daysLeft = Math.ceil((sig.expiry - now) / (1000 * 60 * 60 * 24));
    }

    if (sigExpired) {
      await update(ref(db, `users/${username}`), {
        days: 0,
        credits: 0,
        signature: null
      });
      alert("Your signature expired or not found. You need to create a new signature now.");
      window.location.href = "signature.html?user=" + encodeURIComponent(username);
      return;
    }

    currentUser = username;
    currentUserData = data;

    if (keep) {
      localStorage.setItem("keepSignedInUser", username);
      localStorage.setItem("keepSignedInPass", password);
    } else {
      localStorage.removeItem("keepSignedInUser");
      localStorage.removeItem("keepSignedInPass");
    }

    welcomeText.textContent = `Welcome back, ${username}!`;
    welcomeOverlay.style.display = "flex";

    await new Promise(resolve => {
      function onClick() {
        welcomeOverlay.removeEventListener("click", onClick);
        welcomeAudio.play();
        welcomeOverlay.style.transition = "opacity 0.7s ease";
        welcomeOverlay.style.opacity = 0;
        setTimeout(() => {
          welcomeOverlay.style.display = "none";
          welcomeOverlay.style.opacity = 1;
          resolve();
        }, 700);
      }
      welcomeOverlay.addEventListener("click", onClick);
    });

    document.getElementById("login-form").style.display = "none";
    document.getElementById("report-form").style.display = "block";
    document.getElementById("action-buttons").style.display = "block";
    document.getElementById("user-info").style.display = "block";
    logoutBtn.style.display = "inline-block";
    reporterInput.value = username;
    daysSpan.textContent = data.days || 0;
    creditsSpan.textContent = data.credits || 0;
    sigDaysLeftSpan.textContent = daysLeft;
    await loadUsersDropdowns();
  }

  logoutBtn.onclick = () => {
    currentUser = null;
    currentUserData = null;
    localStorage.removeItem("keepSignedInUser");
    localStorage.removeItem("keepSignedInPass");
    document.getElementById("login-form").style.display = "block";
    document.getElementById("report-form").style.display = "none";
    document.getElementById("action-buttons").style.display = "none";
    document.getElementById("user-info").style.display = "none";
    logoutBtn.style.display = "none";
  };

  document.getElementById("loginBtn").onclick = () => {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();
    const keep = document.getElementById("keepSignedIn").checked;
    if (!username || !password) return alert("Please enter username and password.");
    login(username, password, keep);
  };

  window.addEventListener("DOMContentLoaded", async () => {
    const savedUser = localStorage.getItem("keepSignedInUser");
    const savedPass = localStorage.getItem("keepSignedInPass");
    if (savedUser && savedPass) {
      document.getElementById("username").value = savedUser;
      document.getElementById("password").value = savedPass;
      await login(savedUser, savedPass, true);
    }
  });
</script>

</body>
</html>

